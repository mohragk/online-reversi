<html>
    <head>
        <title>Reversi</title>
        <style>
            .cell {

            }
        </style>
    </head>
    <body>
        <script src="/socket.io/socket.io.js"></script>
    </body>
        <script
            src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs="
            crossorigin="anonymous">
        </script>
      
      <div id= "main">
        <div id="player_data"></div>
      </div>
    

    <script>
        let socket
        let player_number
        
        jQuery(document).ready( function($) {

            socket = io.connect('')

            const grid_table = $('<table>').appendTo('#main')
            for (let row = 0; row < 8; row++) {
                const tr = $('<tr>').attr('id', `row_${row}`)
                    .css({height: '48px '})
                grid_table.append(
                    tr
                )
                for (let col = 0; col < 8; col++) {
                    const td = $('<td>').attr('id', `cell_${row}_${col}`)
                        .css({width: '48px'})
                        .attr('class', 'cell')
                        .css({background: 'black'})
                    tr.append(
                        td
                    )
                }
            }
                

            
            socket.on('waiting', (msg)=> {
                console.log(msg)
            })

            socket.on('player_number', number => {
                player_number = number;
                const player_data = $('#player_data');
                
                const color = player_number == 0 ? 'red' : 'green'
                player_data.text(`You're the ${color} player`)
            })

            socket.on('game_update', (game_state) => {
                if (game_state !== null) {
                    // update grid
                    for (let row = 0; row < 8; row++) {
                        for (let col = 0; col < 8; col++) {
                            const td = $(`#cell_${row}_${col}`)
                            const value = game_state.grid[ row * 8 + col ]
                            let css_bg_color = 'black'
                            if (value == 1) css_bg_color = 'green'
                            if (value == 2) css_bg_color = 'red'
                            
                            td.css({
                                background: css_bg_color
                            })
                        }
                    }
                }
            })

            setInterval(
                () =>{
                    socket.emit('request_update')
                },
                100
            )
            

            $('.cell')
            .click(function() {
                const id = $(this).attr('id')
                const row =  parseInt(id.split('_')[1])
                const col =  parseInt(id.split('_')[2])
                console.log(`clicking ${row} ${col}`)
                socket.emit('add_or_flip_coin', {row, col, player_number})
            })
        })
    </script>
</html>