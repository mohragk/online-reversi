<html>
    <head>
        <title>Reversi</title>
    </head>
    <body>
        <script src="/socket.io/socket.io.js"></script>
    </body>
        <script
            src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs="
            crossorigin="anonymous">
        </script>
      
      <div id= "main">

      </div>
    

    <script>
        let socket
        let player_number
        
        jQuery(document).ready( function($) {

            const grid_table = $('<table>').appendTo('#main')
            for (let row = 0; row < 8; row++) {
                const tr = $('<tr>').attr('id', `row_${row}`)
                grid_table.append(
                    tr
                )
                for (let col = 0; col < 8; col++) {
                    const td = $('<td>').attr('id', `cell_${row}_${col}`)
                        .text('0')
                    tr.append(
                        td
                    )
                }
            }
                

            socket = io.connect('')
            
            socket.on('waiting', (msg)=> {
                console.log(msg)
            })

            socket.on('player_number', number => {
                player_number = number
            })

            socket.on('game_update', (game_state) => {
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const td = $(`#cell_${row}_${col}`)
                        const value = game_state.grid[ row * 8 + col ]
                        td.text(value)
                    }
                }
            })

            setInterval( () => {
                if (player_number == 1) {
                    socket.emit( 'flip_coin', {row: 3, col: 4})
                }
                socket.emit('request_update')
            }
               , 1000
            )
        })
    </script>
</html>